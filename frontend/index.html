<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese AI Tutor</title>
    <link rel = "stylesheet" href = "style.css"> 
</head>
<body>
    <div class="app-layout" id="appLayout">
        <!-- Sidebar overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn" onclick="startNewChat()">
                    <span class="plus-icon">+</span> New Chat
                </button>
                <button class="ai-doc-gen-btn" onclick="showLLMDocumentModal()" title="Generate custom study materials with AI">
                    <span>ü§ñ</span> AI Document Generator
                </button>
            </div>
            <div class="history-section">
                <div class="history-header">Recent Conversations</div>
                <div class="history-list" id="historyList">
                    <div class="loading-history">Loading conversations...</div>
                </div>
            </div>
            <div class="about-section">
                <div class="about-title">About</div>
                <div class="about-content">
                    <p><strong>Japanese AI Tutor</strong> <span class="version-badge">v1.5</span></p>
                    <p>Your personal AI-powered Japanese learning companion!</p>
                    <div class="about-links">
                        <a href="#" class="about-link" onclick="showHelp()">Help</a>
                        <a href="#" class="about-link" onclick="showSettings()">Settings</a>
                        <a href="#" class="about-link" onclick="showFeedback()">Feedback</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="header">
                <div class="header-content">
                    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()" title="Toggle sidebar">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12h18M3 6h18M3 18h18"/>
                        </svg>
                    </button>
                    <span class="flag">üáØüáµ</span>
                    <h1>Japanese AI Tutor</h1>
                    <div class="header-export-container" id="headerExportContainer" style="display: none;">
                        <button class="header-export-btn" id="headerExportBtn" onclick="toggleExportMenu()" title="Export this conversation">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            <span>Export</span>
                        </button>
                        <div class="export-dropdown" id="exportDropdown">
                            <button class="export-dropdown-item" onclick="exportCurrentConversationJSON(); closeExportMenu();">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                                    <path d="M2.75 14A1.75 1.75 0 0 1 1 12.25v-2.5a.75.75 0 0 1 1.5 0v2.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-2.5a.75.75 0 0 1 1.5 0v2.5A1.75 1.75 0 0 1 13.25 14Z"></path>
                                    <path d="M7.25 7.689V2a.75.75 0 0 1 1.5 0v5.689l1.97-1.969a.749.749 0 1 1 1.06 1.06l-3.25 3.25a.749.749 0 0 1-1.06 0L4.22 6.78a.749.749 0 1 1 1.06-1.06l1.97 1.969Z"></path>
                                </svg>
                                <span>Export as JSON</span>
                            </button>
                            <button class="export-dropdown-item" onclick="exportCurrentConversation(); closeExportMenu();">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
                                    <path d="M8.5 1.75a.75.75 0 0 0-1.5 0v6.5H4.56l3.22 3.22a.75.75 0 0 0 1.06 0l3.22-3.22H9.5v-6.5Zm-4 11a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Z"/>
                                </svg>
                                <span>Export as Document</span>
                            </button>
                        </div>
                    </div>
                </div>
                    <h2>„ÅÇ„Å™„Åü„ÅÆÊó•Êú¨Ë™ûË¨õÂ∏´</h2>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <div class="empty-state">
                    <h3>Welcome to your Japanese learning journey!</h3>
                    <p>Start exploring the beautiful world of Japanese language and culture. Ask me anything or choose a suggestion below.</p>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="suggestions-popup" id="suggestionsPopup">
                    <h4>New to Japanese? Here are some quick starters:</h4>
                    <div class="suggestion-buttons">
                        <button class="suggestion-btn" onclick="quickSend('How do I introduce myself in Japanese?')">Self-introduction</button>
                        <button class="suggestion-btn" onclick="quickSend('Teach me basic greetings')">Basic Greetings</button>
                        <button class="suggestion-btn" onclick="quickSend('Explain what are particles and what are the main particles in Japanese. Make a list and give proper examples.')">Get started on Grammar</button>
                        <button class="suggestion-btn" onclick="quickSend('Make a brief introduction into Japanese counting systems')">Numbers & Counting</button>
                        <button class="suggestion-btn" onclick="quickSend('Tell me some tradiotional Japanese dishes and what they are about.')">Food</button>
                        <button class="suggestion-btn" onclick="quickSend('How do I ask for directions?')">Directions</button>
                    </div>
                </div>

                <div class="input-container">
                    <button class="internet-toggle active" id="internetToggle" onclick="toggleInternetSearch()" title="Internet search enabled">
                        <svg id="icon-globe" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="display: block;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L8 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                        <svg id="icon-globe-off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="display: none;"><path d="M22.12 21.71L2.29 1.88C1.9 1.49 1.27 1.49 1.27 1.88s-0.39 1.02 0 1.41l3.24 3.24C3.42 7.87 3 9.87 3 12c0 4.97 4.03 9 9 9c2.13 0 4.13-0.42 5.47-1.12l3.24 3.24c0.39 0.39 1.02 0.39 1.41 0S22.51 22.1 22.12 21.71zM12 19c-3.87 0-7-3.13-7-7c0-1.28 0.35-2.48 0.95-3.52l9.57 9.57C14.48 18.65 13.28 19 12 19zM19 12c0 1.19-0.3 2.3-0.82 3.28l1.45 1.45C20.41 15.55 21 13.85 21 12c0-4.97-4.03-9-9-9c-1.85 0-3.55 0.59-4.73 1.37l1.45 1.45C9.7 5.3 10.81 5 12 5C15.87 5 19 8.13 19 12z"/></svg>
                    </button>
                    <button class="advanced-rag-toggle" id="advancedRagToggle" onclick="toggleAdvancedRAG()" title="Advanced RAG disabled - Click to enable hybrid search + query expansion">
                        <span style="font-size: 18px;">üî¨</span>
                    </button>
                    <textarea id="messageInput" class="message-input" placeholder="Ask me anything about Japanese..." rows="1"></textarea>
                    <button onclick="sendMessage()" class="send-btn" id="sendBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Conversation Modal -->
    <div class="export-modal-overlay" id="exportModal" onclick="closeExportModal(event)">
        <div class="export-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h3>Export Conversation</h3>
                <button class="modal-close-btn" onclick="closeExportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p>Export this conversation as a JSON file.</p>
                <div id="trainingStatus" class="training-status">
                    <!-- Status will be populated by JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeExportModal()">Cancel</button>
                <button class="btn-primary" onclick="confirmExport()">Export</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="js/app-state.js"></script>
    <script src="js/ui-utils.js"></script>
    <script src="js/conversation-history.js"></script>
    <script src="js/messaging.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/document-generation.js"></script>
    <script src="js/app-init.js"></script>
    <script src="js/export.js"></script>
</body>
</html>